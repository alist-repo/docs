import{d as x,L as t,M as p,O as A,_ as T,P as u,o as l,g as o,a as n,Q as s,f as d,R as B,e as C}from"./app-ChJA9yCn.js";import{N as P}from"./Input-DcpdH3y4.js";import{N as b}from"./Alert-BMiKle4X.js";import{B as w}from"./Button-RQT0SqRp.js";import{N as R}from"./Image-ClGLX2aE.js";const q=x({__name:"Token",setup(F,{expose:r}){r();const g=t(""),e=t(""),i=t({uid:"",time:0,qrcode:"",sign:""}),c=t(""),f=t(""),_=t(!1);async function E(){_.value=!0,c.value="";const a=await(await fetch(p(`/alist/115/auth_device_code?app_id=${g.value}`))).json();if(_.value=!1,a.error){c.value=a.error;return}e.value=a.code_verifier,i.value=a.resp;const y=new URL(p("/qr"));y.searchParams.set("text",i.value.qrcode),f.value=y.toString()}const v=t(!1),k=t(""),N=t({access_token:"",refresh_token:"",expires_in:0});async function I(){v.value=!0,k.value="";const a=await(await fetch(p("/alist/115/get_token"),{method:"POST",body:JSON.stringify({code_verifier:e.value,uid:i.value.uid})})).json();if(v.value=!1,a.error){k.value=a.error;return}N.value=a.resp}const m={appId:g,codeVerifier:e,codeResp:i,error1:c,qrCode:f,gettingQrCode:_,generateQrcode:E,gettingToken:v,error2:k,tokenResp:N,getToken:I,get NButton(){return w},get NSpace(){return A},get NImage(){return R},get NAlert(){return b},get NInput(){return P}};return Object.defineProperty(m,"__isScriptSetup",{enumerable:!1,value:!0}),m}});function D(F,r,g,e,i,c){return l(),u(e.NSpace,{vertical:"",size:"large"},{default:o(()=>[n(e.NInput,{value:e.appId,"onUpdate:value":r[0]||(r[0]=f=>e.appId=f),placeholder:"APP ID, 不填则使用 Alist 默认提供"},null,8,["value"]),e.codeVerifier?s("",!0):(l(),u(e.NButton,{key:0,block:"",type:"primary",onClick:e.generateQrcode,loading:e.gettingQrCode},{default:o(()=>r[1]||(r[1]=[d("生成二维码")])),_:1},8,["loading"])),e.error1?(l(),u(e.NAlert,{key:1,title:"Error",type:"error"},{default:o(()=>[d(B(e.error1),1)]),_:1})):s("",!0),e.qrCode?(l(),u(e.NSpace,{key:2,vertical:""},{default:o(()=>[n(e.NSpace,{justify:"center"},{default:o(()=>[n(e.NImage,{width:"300",src:e.qrCode},null,8,["src"])]),_:1}),n(e.NAlert,{title:"扫描二维码",type:"info"},{default:o(()=>r[2]||(r[2]=[d("使用 115 APP 扫描二维码，然后点击下方按钮")])),_:1}),n(e.NButton,{size:"large",onClick:e.getToken,type:"info",block:"",loading:e.gettingToken},{default:o(()=>r[3]||(r[3]=[d("已扫码")])),_:1},8,["loading"]),e.error2?(l(),u(e.NAlert,{key:0,title:"Error",type:"error"},{default:o(()=>[d(B(e.error2),1)]),_:1})):s("",!0)]),_:1})):s("",!0),e.tokenResp.refresh_token?(l(),u(e.NSpace,{key:3,vertical:""},{default:o(()=>[r[4]||(r[4]=C("b",null,"refresh_token:",-1)),n(e.NInput,{type:"textarea",autosize:"",readonly:"",value:e.tokenResp.refresh_token},null,8,["value"]),r[5]||(r[5]=C("b",null,"access_token:",-1)),n(e.NInput,{type:"textarea",autosize:"",readonly:"",value:e.tokenResp.access_token},null,8,["value"])]),_:1})):s("",!0)]),_:1})}const L=T(q,[["render",D],["__file","Token.vue"]]);export{L as T};
